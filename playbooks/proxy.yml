- hosts: proxy
  vars_prompt:
    - name: "rss_telegram_bot_token"
      prompt: "Telegram bot token (ask @BotFather)"
  tasks:
    - docker_container:
        name: mtproxy
        image: "dzhus/mtproxy:2018-08-02@sha256:cf7eb6602b9aa09eda5fd7171617050f9abfaea89481ac927ad38194af016aeb"
        published_ports:
          - "8443:443"
        volumes:
          - "{{ ansible_user_dir }}/mtproxy-config:/data"
        restart_policy: always
    - cron:
        name: "Restart MTProxy as recommended"
        hour: "3"
        minute: "0"
        job: "docker restart mtproxy"
    - docker_container:
        name: rss-to-telegram
        image: "dzhus/rss-to-telegram:2018-08-02@sha256:3d4b47480e500790e76a8a6b3fae32d72261ce0e79084fd461964fe6eadc1107"
        env:
          # Links obtained from https://instantview.telegram.org/my/
          R2T_MESSAGE_FORMAT: "'[â€‰](http://t.me/iv?url={link}&rhash=56bc6e5c05a75e) {link}'"
          R2T_URL: "http://dzhus.org/atom.xml"
          R2T_DESTINATION: "@dzhus"
          R2T_TOKEN: "{{ rss_telegram_bot_token }}"
        restart_policy: always
